<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Moose::Manual::Classes Moose(0.79) - Japan Perl Association ドキュメント和訳プロジェクト</title>
<link rel="stylesheet" type="text/css" href="http://lazy-css.org/css/style.css" />
</head>
<body>
<h1>Moose::Manual::Classes</h1>
<div class="path" id="path"><a href="/">HOME</a> &gt; <a href="/Moose/Manual/Classes.html">Moose::Manual::Classes</a></div><div class="pod">
<!-- INDEX START -->

<ul class="list-index"><li><a href="#">題名</a></li>
<li><a href="#Moose">Mooseを使う</a></li>
<li><a href="#-2">サブクラス化</a></li>
<li><a href="#no_Moose">no Moose</a></li>
<li><a href="#-3">高速化する</a>
<ul>
<li>
<ul><li><a href="#code_new_code">不変化と<code>new()</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#-4">作者</a></li>
<li><a href="#COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</a>
</li>
</ul><!-- INDEX END -->

<h2 id="">題名</h2>
<div id="CONTENT">
<p>Moose::Manual::Classes - クラスにMooseを使わせたり、サブクラス化したりする</p>

</div>
<h2 id="Moose">Mooseを使う</h2>
<div id="Moose_CONTENT">
<p>Mooseの使い方は非常に簡単、<code>use Moose</code>するだけです。</p>
<pre>  package Person;

  use Moose;

</pre>
<p>これでMooseを使ったクラスができました!</p>
<p>もっとも、その裏では本当はいろいろなことが起こっています。ひとつひとつ見ていきましょう。</p>
<p><cite>Moose</cite>をロードすると、<code>extends</code>、<code>has</code>、<code>with</code>といったシュガー関数が山ほどクラスにエクスポートされます。これらの関数はクラスを定義するときに使います。たとえば、アトリビュートを定義したい場合はこのようにします。</p>
<pre>  package Person;

  use Moose;

  has 'ssn' =&gt; ( is =&gt; 'rw' );

</pre>
<p>アトリビュートについては<cite>Moose::Manual::Attributes</cite>のドキュメントをご覧ください。</p>
<p>また、Mooseをロードしたクラスでは<code>strict</code>プラグマと<code>warnings</code>プラグマも有効になります。</p>
<p>Mooseをロードすると、そのクラスは<cite>Moose::Object</cite>のサブクラスになります。<cite>Moose::Object</cite>クラスにはデフォルトのコンストラクタやデストラクタのほか、オブジェクトを生成するヘルパーメソッドがあります。詳しくは<cite>Moose::Manual::Construction</cite>のドキュメントをご覧ください。</p>
<p>また、Mooseは便利に使えるように、そのクラスのために新しい型も生成します。型については<cite>Moose::Manual::Types</cite>のドキュメントをご覧ください。</p>
<p>さらに、そのクラスの<cite>Moose::Meta::Class</cite>オブジェクトも生成します。このメタクラスオブジェクトは、<code>Person-&gt;meta</code>のようにクラスの<code>meta</code>メソッドを呼ぶと利用できます。</p>
<p>このメタクラスオブジェクトは、イントロスペクション用のAPIを提供します。Mooseも裏ではこのAPIを使ってアトリビュートを追加したり親クラスを定義したりしています。実は、Mooseのシュガー関数はどれも、実際にしているのはこのメタクラスオブジェクト（や、ほかのメタAPIオブジェクト）のメソッドを呼ぶことなのです。</p>

</div>
<h2 id="-2">サブクラス化</h2>
<div id="CONTENT-2">
<p>Mooseは親クラスを宣言するために<code>extends</code>という簡単なシュガー関数を提供しています。</p>
<pre>  package User;

  use Moose;

  extends 'Person';

  has 'username' =&gt; ( is =&gt; 'rw' );

</pre>
<p>なお、親クラスは<code>extends</code>を呼ぶたびに「リセット」されます。多重継承したい場合は、<code>extends 'Foo', 'Bar'</code>のようにすべての親クラスを一度に指定する必要があります。</p>
<p>Mooseを使っていない親クラスをMooseを使って継承することもできますが、その場合、親クラスのコンストラクタを継承することになりますので（親クラスのコンストラクタも<code>new</code>という名前であれば、ですが）、アトリビュートの初期化は自分で（親クラスのコンストラクタか、サブクラスの中で）しなければなりませんし、Mooseの魔法もかなり使えなくなります。</p>

</div>
<h2 id="no_Moose">no Moose</h2>
<div id="no_Moose_CONTENT">
<p>Mooseのシュガー関数はクラスの名前空間から削除することもできます。この機能を使うととにかくクラスが「きれい」になるのでおすすめです。この機能は、モジュールファイルの末尾に<code>no Moose</code>を追加するだけで使えます。</p>
<pre>  package Person;

  use Moose;

  has 'ssn' =&gt; ( is =&gt; 'rw' );

  no Moose;

</pre>
<p>こうするとMooseのシュガー関数がクラスの名前空間から消えるので、<code>Person-&gt;can('has')</code>が真を返さなくなります。</p>

</div>
<h2 id="-3">高速化する</h2>
<div id="CONTENT-3">
<p>Mooseには「不変化」という機能があります。この機能を使うと、実行時にクラスを大幅に高速化できます。ただし、この機能を使うと、クラスをはじめてロードするときにはコストがかかります。また、クラスを不変化すると、その先クラスを変更してアトリビュートやメソッド、ロールなどを追加することはできなくなります。</p>
<p>ただし、そのおかげでMooseはそのクラス専用のコードを生成することができるようになります。とりわけ「インライン」コンストラクタを生成するので、オブジェクトの生成が非常に速くなります。</p>
<p>クラスを不変化するには、単にそのクラスのメタクラスオブジェクトの<code>make_immutable</code>を呼んでください。</p>
<pre>  __PACKAGE__-&gt;meta-&gt;make_immutable;

</pre>

</div>
<h3 id="code_new_code">不変化と<code>new()</code></h3>
<div id="code_new_code_CONTENT">
<p>クラスの<code>new()</code>をオーバーライドしてしまうと、不変化用のコードがクラスに最適化したコンストラクタを用意できなくなってしまうので、<code>BUILD()</code>メソッドを使うようにしてください。<code>BUILD()</code>メソッドはインライン展開されたコンストラクタからも呼ばれます。</p>
<p>または、どうしても別の<code>new()</code>を用意する必要がある場合は、自前の不変化メソッドを用意することもできます。そのためにはMooseのメタクラスを拡張する必要がありますが、それについてはこのマニュアルでは取り扱いません。</p>

</div>
<h2 id="-4">作者</h2>
<div id="CONTENT-4">
<p>Dave Rolsky &lt;autarch@urth.org&gt;</p>

</div>
<h2 id="COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</h2>
<div id="COPYRIGHT_AND_LICENSE_CONTENT">
<p>Copyright 2008-2009 by Infinity Interactive, Inc.</p>
<p><a href="http://www.iinteractive.com">http://www.iinteractive.com</a></p>
<p>This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.</p>

</div>
</div>
<div class="head">
	<div class="logo">
	<img src="http://lazy-css.org/css/img/logo.png">
	</div>
	<ul class="global-navi">

	<li><img src="http://lazy-css.org/css/img/g_home.png" alt="ホーム"></li>
	<li><img src="http://lazy-css.org/css/img/g_news.png" alt="ニュース"></li>
	<li><img src="http://lazy-css.org/css/img/g_blog.png" alt="ブログ"></li>
	</ul>
</div>
<ul class="sub-navi">
<li><img src="http://lazy-css.org/css/img/inq.png" alt="お問い合わせ"></li>
</ul>

<div class="footer">
<ul class="footer-navi">
	<li>リンク</li>
	<li>リンク</li>
	<li>リンク</li>
	<li>リンク</li>
</ul>
<address>&copy; copyright 2009 jpa all right reserved.</address>
</div>
</body>
</html>

