<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ja" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf8" />
<title>Moose::Cookbook::Extending::Recipe2 Moose(0.79) - Japan Perl Association ドキュメント和訳プロジェクト</title>
<link rel="stylesheet" type="text/css" href="http://lazy-css.org/css/style.css">
</head>
<body>

	
<h1>Moose::Cookbook::Extending::Recipe2</h1>
<div class="path" id="path"><a href="/">HOME</a> &gt; <a href="/Moose/Cookbook/Extending/Recipe2.html">Moose::Cookbook::Extending::Recipe2</a></div><div class="pod">
<!-- INDEX START -->

<ul class="list-index"><li><a href="#">題名</a></li>
<li><a href="#-2">概要</a></li>
<li><a href="#-3">本文</a></li>
<li><a href="#-4">作者</a></li>
<li><a href="#COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</a>
</li>
</ul><!-- INDEX END -->

<h2 id="">題名</h2>
<div id="CONTENT">
<p>Moose::Cookbook::Extending::Recipe2 - オブジェクトのベースクラス用のロールを用意する</p>

</div>
<h2 id="-2">概要</h2>
<div id="CONTENT-2">
<pre>  package MooseX::Debugging;

  use Moose ();
  use Moose::Exporter;
  use Moose::Util::MetaRole;

  Moose::Exporter-&gt;setup_import_methods;

  sub init_meta {
      shift;
      my %options = @_;

      my $meta = Moose-&gt;init_meta(%options);

      Moose::Util::MetaRole::apply_base_class_roles(
          for_class =&gt; $options{for_class},
          roles     =&gt; ['MooseX::Debugging::Role::Object'],
      );

      return $meta;
  }

  package MooseX::Debugging::Role::Object;

  use Moose::Role;

  after 'BUILD' =&gt; sub {
      my $self = shift;

      warn &quot;Made a new &quot; . ref $self . &quot; object\n&quot;;
  };

</pre>

</div>
<h2 id="-3">本文</h2>
<div id="CONTENT-3">
<p>この例では、オブジェクトのベースクラス用のロールを用意して、簡単なデバッグ用の出力を追加します。このロールは、オブジェクトを生成するたびにそのオブジェクトの種類を知らせる警告を吐きます。</p>
<p>もちろん本物のデバッグ用ロールではもっと興味深いことをするものですが、このレシピで大切なのはこのロールをどう組み込むかということだけです。</p>
<p>今回は、<cite>Moose::Exporter</cite>と<cite>Moose::Util::MetaRole</cite>を組み合わせて、モジュールが<code>use&nbsp;MooseX::Debugging</code>したときにはかならずベースオブジェクトのクラスにデバッグ用ロールが自動的に組み込まれるようにしています。</p>
<p>いくつかのコードについてはもっと細かく見ていきましょう。</p>
<pre>  Moose::Exporter-&gt;setup_import_methods;

</pre>
<p>これは<code>MooseX::Debugging</code>パッケージに<code>import</code>メソッドを用意するものです。ここでは実際になにかをエクスポートするわけではないので<code>setup_import_methods</code>にはパラメータを渡していませんが、<code>import</code>メソッドがないと私たちの<code>init_meta</code>メソッドが確実に呼ばれることは保証できないのです。</p>
<p>それから、私たちの<code>init_meta</code>メソッドにはこのような行があります。</p>
<pre>      Moose-&gt;init_meta(%options);

</pre>
<p>これはほとんどどんな拡張モジュールでも使う決まり文句のようなものです。こうしておくと、呼び出し元のクラスにトレートを追加する「前」に通常のMooseのメタクラスを確実に用意できるようになります。</p>
<p><code>Moose-&gt;init_meta</code>メソッドを使えば確実に呼び出し元のクラスにまともなメタクラスを用意できますが、拡張モジュールの中ではそのロジックを繰り返したくはありません。<code>Moose-&gt;init_meta</code>がすでに呼ばれていた（呼び出し元のクラスが私たちの拡張モジュールをuseする前に<code>use&nbsp;Moose</code>していた）場合、2度目の<code>Moose-&gt;init_meta</code>は実質的には無効になります。</p>

</div>
<h2 id="-4">作者</h2>
<div id="CONTENT-4">
<p>Dave Rolsky &lt;autarch@urth.org&gt;</p>

</div>
<h2 id="COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</h2>
<div id="COPYRIGHT_AND_LICENSE_CONTENT">
<p>Copyright 2009 by Infinity Interactive, Inc.</p>
<p><a href="http://www.iinteractive.com">http://www.iinteractive.com</a></p>
<p>This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.</p>

</div>
</div>
<div class="head">
	<div class="logo">
	<img src="http://lazy-css.org/css/img/logo.png">
	</div>
	<ul class="global-navi">

	<li><img src="http://lazy-css.org/css/img/g_home.png" alt="ホーム"></li>
	<li><img src="http://lazy-css.org/css/img/g_news.png" alt="ニュース"></li>
	<li><img src="http://lazy-css.org/css/img/g_blog.png" alt="ブログ"></li>
	</ul>
</div>


<div class="footer">
<ul class="footer-navi">
	<li>リンク</li>
	<li>リンク</li>
	<li>リンク</li>

	<li>リンク</li>
</ul>
<address>&copy; copyright 2009 jpa all right reserved.</address>
</div>
</body>
</html>

