<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="ja" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf8" />
<title>Moose::Cookbook::Roles::Recipe3 Moose(0.79) - Japan Perl Association ドキュメント和訳プロジェクト</title>
<link rel="stylesheet" type="text/css" href="http://lazy-css.org/css/style.css">
</head>
<body>

	
<h1>Moose::Cookbook::Roles::Recipe3</h1>
<div class="path" id="path"><a href="/">HOME</a> &gt; <a href="/Moose/Cookbook/Roles/Recipe3.html">Moose::Cookbook::Roles::Recipe3</a></div><div class="pod">
<!-- INDEX START -->

<ul class="list-index"><li><a href="#">題名</a></li>
<li><a href="#-2">概要</a></li>
<li><a href="#-3">本文</a></li>
<li><a href="#-4">まとめ</a></li>
<li><a href="#-5">作者</a></li>
<li><a href="#COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</a>
</li>
</ul><!-- INDEX END -->

<h2 id="">題名</h2>
<div id="CONTENT">
<p>Moose::Cookbook::Roles::Recipe3 - オブジェクトのインスタンスにロールを組み込む</p>

</div>
<h2 id="-2">概要</h2>
<div id="CONTENT-2">
<pre>  package MyApp::Role::Job::Manager;

  use List::Util qw( first );

  use Moose::Role;

  has 'employees' =&gt; (
      is  =&gt; 'rw',
      isa =&gt; 'ArrayRef[Employee]',
  );

  sub assign_work {
      my $self = shift;
      my $work = shift;

      my $employee = first { !$_-&gt;has_work } @{ $self-&gt;employees };

      die 'All my employees have work to do!' unless $employee;

      $employee-&gt;work($work);
  }

  package main;

  my $lisa = Employee-&gt;new( name =&gt; 'Lisa' );
  MyApp::Role::Job::Manager-&gt;meta-&gt;apply($lisa);

  my $homer = Employee-&gt;new( name =&gt; 'Homer' );
  my $bart  = Employee-&gt;new( name =&gt; 'Bart' );
  my $marge = Employee-&gt;new( name =&gt; 'Marge' );

  $lisa-&gt;employees( [ $homer, $bart, $marge ] );
  $lisa-&gt;assign_work('mow the lawn');

</pre>

</div>
<h2 id="-3">本文</h2>
<div id="CONTENT-3">
<p>このレシピではオブジェクトにロールを組み込む方法を紹介します。この例では、ひとりの従業員にマネージャーの職責を与えています。</p>
<p>ロールをオブジェクトに組み込む方法は簡単です。<cite>Moose::Meta::Role</cite>オブジェクトが提供している<code>apply</code>というメソッドにオブジェクトのインスタンスを渡せば、あとはよきに計らってくれます。</p>
<pre>  MyApp::Role::Job::Manager-&gt;meta-&gt;apply($lisa);

</pre>
<p>また、<cite>Moose::Util</cite>の<code>apply_all_roles</code>関数を使う手もあります。</p>
<pre>  apply_all_roles( $person, MyApp::Role::Job::Manager-&gt;meta );

</pre>
<p><code>apply_all_roles</code>を使う主な利点は、一度に複数のロールを組み込めるということです。</p>
<p>組み込もうとしているロールにパラメータを渡すこともできます。</p>
<pre>  MyApp::Role::Job::Manager-&gt;meta-&gt;apply(
      $lisa,
      alias =&gt; { assign_work =&gt; 'get_off_your_lazy_behind' },
  );

</pre>
<p>メソッドの排除や別名の動作については<b>ロールのレシピ2</b> (<cite>Moose::Cookbook::Roles::Recipe2</cite>)で例を見ました。</p>

</div>
<h2 id="-4">まとめ</h2>
<div id="CONTENT-4">
<p>オブジェクトのインスタンスにロールを組み込むやり方は、既存のオブジェクトに振る舞いを追加したくなったときに便利です。今回の例では、これを効果的に利用して昇進をモデリングしました。</p>
<p>また、これは既存の、特にMooseを使っていないコードにある種の控えめなモンキーパッチをあてるときにも便利です。たとえばデバッグ用のロールを作って、実行時にオブジェクトに組み込むようなこともできるかもしれません。</p>

</div>
<h2 id="-5">作者</h2>
<div id="CONTENT-5">
<p>Dave Rolsky &lt;autarch@urth.org&gt;</p>

</div>
<h2 id="COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</h2>
<div id="COPYRIGHT_AND_LICENSE_CONTENT">
<p>Copyright 2006-2009 by Infinity Interactive, Inc.</p>
<p><a href="http://www.iinteractive.com">http://www.iinteractive.com</a></p>
<p>This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.</p>

</div>
</div>
<div class="head">
	<div class="logo">
	<img src="http://lazy-css.org/css/img/logo.png">
	</div>
	<ul class="global-navi">

	<li><img src="http://lazy-css.org/css/img/g_home.png" alt="ホーム"></li>
	<li><img src="http://lazy-css.org/css/img/g_news.png" alt="ニュース"></li>
	<li><img src="http://lazy-css.org/css/img/g_blog.png" alt="ブログ"></li>
	</ul>
</div>


<div class="footer">
<ul class="footer-navi">
	<li>リンク</li>
	<li>リンク</li>
	<li>リンク</li>

	<li>リンク</li>
</ul>
<address>&copy; copyright 2009 jpa all right reserved.</address>
</div>
</body>
</html>

