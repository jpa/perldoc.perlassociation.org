<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="Japan Perl Association CPAN和訳ドキュメント">
<meta name="keyword" content="perl,cpan,jpa,和訳,日本語訳">
<title>Moose::Cookbook::Roles::Recipe1 Moose(0.79) - Japan Perl Association ドキュメント和訳プロジェクト</title>
<link rel="stylesheet" type="text/css" href="http://lazy-css.org/css/style.css" />
</head>
<body>
<h1>Moose::Cookbook::Roles::Recipe1</h1>
<div class="path" id="path"><a href="/">HOME</a> &gt; <strong>Moose::Cookbook::Roles::Recipe1</strong></div><div class="pod">
<!-- INDEX START -->

<ul class="list-index"><li><a href="#">題名</a></li>
<li><a href="#-2">概要</a></li>
<li><a href="#-3">本文</a></li>
<li><a href="#-4">まとめ</a></li>
<li><a href="#-5">脚注</a></li>
<li><a href="#-6">作者</a></li>
<li><a href="#COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</a>
</li>
</ul><!-- INDEX END -->

<h2 id="">題名</h2>
<div id="CONTENT">
<p>Moose::Cookbook::Roles::Recipe1 - Moose::Roleの例</p>

</div>
<h2 id="-2">概要</h2>
<div id="CONTENT-2">
<pre>  package Eq;
  use Moose::Role;

  requires 'equal_to';

  sub not_equal_to {
      my ( $self, $other ) = @_;
      not $self-&gt;equal_to($other);
  }

  package Comparable;
  use Moose::Role;

  with 'Eq';

  requires 'compare';

  sub equal_to {
      my ( $self, $other ) = @_;
      $self-&gt;compare($other) == 0;
  }

  sub greater_than {
      my ( $self, $other ) = @_;
      $self-&gt;compare($other) == 1;
  }

  sub less_than {
      my ( $self, $other ) = @_;
      $self-&gt;compare($other) == -1;
  }

  sub greater_than_or_equal_to {
      my ( $self, $other ) = @_;
      $self-&gt;greater_than($other) || $self-&gt;equal_to($other);
  }

  sub less_than_or_equal_to {
      my ( $self, $other ) = @_;
      $self-&gt;less_than($other) || $self-&gt;equal_to($other);
  }

  package Printable;
  use Moose::Role;

  requires 'to_string';

  package US::Currency;
  use Moose;

  with 'Comparable', 'Printable';

  has 'amount' =&gt; ( is =&gt; 'rw', isa =&gt; 'Num', default =&gt; 0 );

  sub compare {
      my ( $self, $other ) = @_;
      $self-&gt;amount &lt;=&gt; $other-&gt;amount;
  }

  sub to_string {
      my $self = shift;
      sprintf '$%0.2f USD' =&gt; $self-&gt;amount;
  }

</pre>

</div>
<h2 id="-3">本文</h2>
<div id="CONTENT-3">
<p>Rolesにはおもに2つの目的があります。インタフェースと、コードの再利用です。このレシピでは、比較を定義するロールとオブジェクトのコードを表示するロールを利用して、コードの再利用について説明します。</p>
<p>まずは<code>Eq</code>から見ていきましょう。最初に<code>use Moose</code>が<code>use Moose::Role</code>になっているところに注目してください。また、<code>requires</code>という新しいシュガー関数も使われています。</p>
<pre>  requires 'equal_to';

</pre>
<p>これは、このロールを取り込むクラスはかならず<code>equal_to</code>というメソッドを用意する必要がある、という意味です。このメソッドは、ロールを取り込むクラスに直書きしてもよいですし、ほかのロールから取り込んでもかまいません。</p>
<p><code>Eq</code>ロールには、要求した<code>equal_to</code>メソッドを利用した<code>not_equal_to</code>というメソッドが定義されています。このようにすると、ロールを取り込むクラスが用意しなければならないメソッドを最小限にとどめることができます。</p>
<p>次の<code>Comparable</code>ロールは、<code>Eq</code>ロールを下敷きにして作られています。ここでは<code>with</code>という新しいシュガー関数を利用して<code>Eq</code>を<code>Comparable</code>の中に取り込んでいます。</p>
<pre>  with 'Eq';

</pre>
<p><code>with</code>関数は取り込みたいロールのリストを引数に取ります。この例では、<code>Eq</code>が要求している<code>equal_to</code>メソッドを<code>Comparable</code>ロールが用意していますが、そのようにしないこともできます（その場合は<code>Comparable</code>を取り込むクラスが自前で<code>equal_to</code>を用意する必要があります）。言い換えると、ロールは必須メソッドを用意「しなくても」ほかのロールを取り込める、ということです。</p>
<p><code>Comparable</code>ロールは<code>compare</code>というメソッドを要求します。</p>
<pre>  requires 'compare';

</pre>
<p>また、<code>Comparable</code>ロールはほかにも最終的には<code>compare</code>に依存するいくつかのメソッドを提供しています。</p>
<pre>  sub equal_to {
      my ( $self, $other ) = @_;
      $self-&gt;compare($other) == 0;
  }

  sub greater_than {
      my ( $self, $other ) = @_;
      $self-&gt;compare($other) == 1;
  }

  sub less_than {
      my ( $self, $other ) = @_;
      $self-&gt;compare($other) == -1;
  }

  sub greater_than_or_equal_to {
      my ( $self, $other ) = @_;
      $self-&gt;greater_than($other) || $self-&gt;equal_to($other);
  }

  sub less_than_or_equal_to {
      my ( $self, $other ) = @_;
      $self-&gt;less_than($other) || $self-&gt;equal_to($other);
  }

</pre>
<p>最後は<code>Printable</code>ロールです。このロールはインタフェースを提供するためだけに存在しています（メソッドはなく、必須メソッドのリストしかありません）。この場合、<code>to_string</code>メソッドだけを要求しています。</p>
<p>インタフェースロールが便利なのは、メソッドと「名前」の双方を定義してくれるからです。このロールを組み込んだクラスはかならず<code>to_string</code>メソッドを持っていることがわかるだけでなく、このメソッドが期待通りの意味を持っていることも想定できます（おそらく実際のコードでは<code>Printable</code>ロールのドキュメントにメソッドの意味が書かれるはずです）。</p>
<p>最後の<code>US::Currency</code>クラスでは、<code>Comparable</code>ロールと<code>Printable</code>ロールを両方取り込んでいます。</p>
<pre>  with 'Comparable', 'Printable';

</pre>
<p>また、<code>amount</code>という、通常のMooseのアトリビュートも定義されています。</p>
<pre>  has 'amount' =&gt; ( is =&gt; 'rw', isa =&gt; 'Num', default =&gt; 0 );

</pre>
<p>最後に、私たちのロールが要求しているメソッドの実装を見ていきます。<code>compare</code>メソッドはこうです。</p>
<pre>  sub compare {
      my ( $self, $other ) = @_;
      $self-&gt;amount &lt;=&gt; $other-&gt;amount;
  }

</pre>
<p><code>Comparable</code>ロールを取り込んでこのメソッドを定義してやると、<code>equal_to</code>、<code>greater_than</code>、<code>less_than</code>、<code>greater_than_or_equal_to</code>、<code>less_than_or_equal_to</code>というメソッドが自由に使えるようになります。</p>
<p>あとは、<code>to_string</code>メソッドです。</p>
<pre>  sub to_string {
      my $self = shift;
      sprintf '$%0.2f USD' =&gt; $self-&gt;amount;
  }

</pre>

</div>
<h2 id="-4">まとめ</h2>
<div id="CONTENT-4">
<p>ロールは非常に強力なものになりえます。再利用可能な振る舞いをカプセル化したり、クラスが提供するメソッドの（意味やインタフェースといった）情報をやりとりしたりするうえではすばらしいツールです。</p>

</div>
<h2 id="-5">脚注</h2>
<div id="CONTENT-5">
<dl>
	<dt>(1)</dt>
	<dd>
		<p><code>Runner</code>と<code>Process</code>という2つのクラスがあるものと思ってください。どちらにも<code>run</code>というメソッドがありますが、オブジェクトに<code>run</code>メソッドの実装を要求するだけでは、このメソッドが「実際になにをするか」はまだなんとも言えません。ところが、<code>Executable</code>ロールを実装しているオブジェクトを要求していれば、ある程度意味がわかるようになります。</p>
	</dd>
</dl>

</div>
<h2 id="-6">作者</h2>
<div id="CONTENT-6">
<p>Stevan Little &lt;stevan@iinteractive.com&gt;</p>
<p>Dave Rolsky &lt;autarch@urth.org&gt;</p>

</div>
<h2 id="COPYRIGHT_AND_LICENSE">COPYRIGHT AND LICENSE</h2>
<div id="COPYRIGHT_AND_LICENSE_CONTENT">
<p>Copyright 2006-2009 by Infinity Interactive, Inc.</p>
<p><a href="http://www.iinteractive.com">http://www.iinteractive.com</a></p>
<p>This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.</p>

</div>
</div>
<div class="head">
	<div class="logo">
	<img src="http://lazy-css.org/css/img/logo.png">
	</div>
	<ul class="global-navi">

	<li><img src="http://lazy-css.org/css/img/g_home.png" alt="ホーム"></li>
	<li><img src="http://lazy-css.org/css/img/g_news.png" alt="ニュース"></li>
	<li><img src="http://lazy-css.org/css/img/g_blog.png" alt="ブログ"></li>
	</ul>
</div>
<ul class="sub-navi">
<li><img src="http://lazy-css.org/css/img/inq.png" alt="お問い合わせ"></li>
</ul>

<div class="footer">
<ul class="footer-navi">
	<li>リンク</li>
	<li>リンク</li>
	<li>リンク</li>
	<li>リンク</li>
</ul>
<address>&copy; copyright 2009 jpa all right reserved.</address>
</div>
</body>
</html>

